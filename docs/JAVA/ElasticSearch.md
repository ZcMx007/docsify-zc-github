# ElasticSearch

> 这篇文章是基于狂神的ElasticSearch教程而来，B站搜索：[遇见狂神说](https://space.bilibili.com/95256449)

ElasticSearch是一个基于Lucene技术的，使用Restful web接口风格的，使用Java语言编写的分布式多用户的全文搜索引擎技术。

## 聊聊ElasticSearch的前世今生

众所周知，ElasticSearch是基于Lucene，Lucene是一个开放源代码的全文检索引擎工具包，它提供了完整的查询引擎和索引引擎，但并不是完整的一个搜索引擎，但它是搜索引擎的核心部分。并且Lucene技术源于大名鼎鼎的Doug Cutting，一位资深的全文索引/检索专家。（Doug Cutting有一种神奇的能力，那就是可以根据一篇技术论文使一项基于该技术理论的产品落地，真的是非常非常的厉害呀！）和ElasticSearch一样基于Lucene实现的搜索引擎技术还有solr（ElasticSearch的前辈）。solr是老牌的搜索引擎的技术，其社区比较活跃，并且支持的检索格式不仅仅有JSON格式，还有XML等格式，而ElasticSearch仅仅支持JSON格式（现在基本上都是JSON格式）。而且solr不仅仅支持ElasticSearch仅支持的Restful web风格的接口，还支持老式的web Service风格的接口（现在基本使用的都是restful web风格的接口了）。但由于如今的大数据时代，数据更加的庞杂且混乱，而使用solr检索数据并没有ElasticSearch那样的高效，因此在大数据环境下就显得有些捉襟见肘了。并且ElasticSearch还比solr更易上手使用。基于这点，ElasticSearch在一经推出便收获了大量的用户使用，类似于百度，淘宝，京东等大型网站都是使用它作为搜索引擎技术的核心。

## 进一步了解ElasticSearch

### 构成

ElasticSearch是由索引、类别（类别在ElasticSearch7版本中已被废弃，而在ElasticSearch8中将被彻底废除）、文档构成。

对应的其实就是MySQL中的库、表、行数据。理解起来不难。

如果是在ElasticSearch集群中，则还将涉及到ElasticSearch节点和分片的概念。在分布式集群中，每台ElasticSearch服务器都是一个节点，而每个索引都不会单独保存在一个ElasticSearch节点上，这样不安全而且太大了，因此会将一个索引分片并给每一个分片拷贝一个备份分片按照一定的容灾逻辑分别保存在不同的服务器上，使得在一台服务器宕机后不影响该索引的使用！如果根据ElasticSearch默认的5个分片，并且给该集群配置三台ElasticSearch服务器的话，那么，如下图模拟的一种节点分配分片的方式就是可以的：

![ElasticSearch分片](images/2021-08-19-19-03-01.png)

ElasticSearch中还有一个十分重要的概念，那就是**倒排索引**，又称为反向索引（其实这是Lucene的特性，solr也有），这也是ElasticSearch这么快的原因之一。我们正常的生活中人的思维模式一般都是正向索引，例如通过某篇小说的名字记起该小说中的内容，但要是让你根据小说中的某个章节或者某段话来记起该小说的具体内容时，那将是比较困难的。如果有这样一篇小说，你能根据其中的文字推断出该文章的具体内容，那就可以说是在脑海中建立起了关于该文章的倒排索引了，比如我们都熟悉的一句话——你站在此处别动，待为父去给你买几个橘子。搜索引擎就是基于这样的原理实现的。但是如果所有的文字都建立一遍倒排索引的话，那也将会使用非常多的硬盘空间来存储，而我们日常生活中使用倒排索引其实并不是能够直接回忆起该文章的内容，而是先想到该文章的标题，技术也一样，如果倒排索引时value中存储的只是正向索引时的key值，那将能大大减少存储的硬盘空间，这又称之为倒排索引压缩。此处参考了搜狐上的一篇文章，详情移步[原文](https://www.sohu.com/a/306244095_463994)。

### 应用

毫无疑问，使用ElasticSearch最常用的用途就是用它实现搜索技术。但其实它还有一项重要的技术，那就是分布式日志分析（简称ELK），当然也有人称之为开源实时日志分析技术栈。它分别由三个技术开源组成：分别是Elasticsearch,logstash,kibana，先由logstash进行接收处理和转发日志操作，再由Elasticsearch给日志建立索引，最后使用kibana视图工具处理展示Elasticsearch检索日志页面。例如在分布式系统中，有着几百台服务器，那么如果一台服务器出问题了，运维人员不会一台台远程连接查看，而是通过ELK工具，检索日志出错的信息从而分析问题所在。

## 安装Elasticsearch以及其他附属工具

